---
title: "Visualizing COVID19 Mobility trends using google data"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
mob_trend <- readr::read_csv("global_mobility_trends_smaller.csv")
```


## Background

In this lab, we're going to use data visualizations to analyze and understand the influence of COVID19 on mobility trends using google data.

The goal of the lab is not to teach how to do the visualization. Don't worry, you will get there eventually, but it will take some more workshop meetings. 

The goal is to expose you to coding, let you play a little with code, and also show you some nice things that can be done.

In this lab you will have a chance to see:

   1. How a data structure looks like.
   2. How two different structures can have the same information, but serve different purposes.
   3. How data can be visualized.
   4. You will interpret and understand the visualization, using Israel's trends.
   5. You will change the code to make the visualization show a different country and try to interpret it as well.

## The data

Our data comes from google mobility trends, here: [https://www.google.com/covid19/mobility/](https://www.google.com/covid19/mobility/).

They provide a baseline of "mobility" for each country, before the pandemic, and for every day during the pandemic. The data covers different areas such as residential, workplace, and more.

Run the following code to generate a visualization for the data:

```{r visualize-mobility-trends, exercise=TRUE}

mob_trend %>% 
  filter(country_region == "Israel") %>% 
  pivot_longer(cols = retail_and_recreation:residential, names_to = "area", values_to = "trend") %>% 
  ggplot(aes(x = date, y = trend, color = area)) + 
  geom_point(size = 0.5, alpha = 0.5) + 
  geom_smooth() +
  facet_wrap(~area)

```

Discuss the plot for a few minutes, try to interpret the different trends you see (for example in light of the first and second lockdowns we experienced). 

Answer these questions:

```{r plot-questions-1}
question_radio("During April mobility decreased in all areas but one. Which is it?",
               answer("Grocery and pharmacy"),
               answer("Parks"),
               answer("Residential", correct = TRUE),
               answer("Transit stations"),
               answer("Workplaces"),
               correct = random_praise(),
               incorrect = random_encouragement(),
               random_answer_order = T,
               allow_retry = TRUE,
               try_again = incorrect)
```

```{r plot-questions-2}

question_checkbox("Which areas are relatively stable during the period? i.e., exhibit little change?",
                  answer("Grocery and pharmacy", correct = TRUE),
                  answer("Parks"),
                  answer("Residential", correct = TRUE),
                  answer("Retail and recreation"),
                  answer("Transit stations"),
                  answer("Workplaces"),
                  correct = random_praise(),
                  incorrect = random_encouragement(),
                  random_answer_order = T,
                  allow_retry = TRUE,
                  try_again = incorrect
                  )

```

The previous code generated a plot for Israel's data. Run the following code and see what other countries exist in the data.

```{r which-countries-in-the-data, exercise=TRUE}
mob_trend %>%
  distinct(country_region)
```

In the following box, change the code to show a different country: 

```{r visualize-mobility-trends-other-countries, exercise=TRUE}

mob_trend %>% 
  filter(country_region == "Israel") %>% 
  pivot_longer(cols = retail_and_recreation:residential, names_to = "area", values_to = "trend") %>% 
  ggplot(aes(x = date, y = trend, color = area)) + 
  geom_point(size = 0.5, alpha = 0.5) + 
  geom_smooth() +
  facet_wrap(~area)

```


## Under the hood

You've seen the plots that we can make, but let's see how the data behind the plot is arranged.

Run the following code and have a look at the resulting table which represents the data (note that you can browse the different pages at the buttom right and you can extend the table to the right using the small right arrow).

```{r table-original-data, exercise=TRUE}
mob_trend
```

```{r data-variables}
question_text("How many variables (columns) are there in the data?",
              answer("8", message = "That's exactly right!", correct = TRUE),
              allow_retry = T
              )
```

```{r data-variable-types}
question_checkbox("Which variable types are there in the data?",
                  answer("Character", correct = TRUE),
                  answer("Numeric", correct = TRUE),
                  answer("Date", correct = TRUE),
                  answer("Logical (boolean)"),
                  answer("Factor"),
                  random_answer_order = T,
                  allow_retry = T)
```

A data set is called "tidy" if every row constitues an observation and every column is a variable. Very much like the data set we have worked with: every row is an observation of a specific country/region at a specific date. The columns include country/region, date, and the different aread in which mobility was measured.

Prior to plotting the data, we used a short code which slightly transformed our data (kept it tidy but in a different manner). Let's isolate just that code and see how the data was modified:

```{r table-original-data-long, exercise=TRUE}
mob_trend2 <- mob_trend %>%
  pivot_longer(cols = retail_and_recreation:residential, names_to = "area", values_to = "trend")

mob_trend2
```

```{r long-versus-wide}
question_radio("Both forms contain the same information, but are structured differently. What would you consider a long format, and what would you consider a wide format?",
               answer("Both are long"),
               answer("Both are wide"),
               answer("`mob_trend` is long and `mob_trend2` is wide"),
               answer("`mob_trend` is wide and `mob_trend2` is long", correct = TRUE),
               correct = "Great job!",
               incorrect = "Try again",
               allow_retry = T)
```

## Critical thinking

As a researcher, you should always keep your eyes out for the small letters, and be able to understand if the data you are using has some kind of limitations or biases.

Visit the google site: [https://www.google.com/covid19/mobility/](https://www.google.com/covid19/mobility/). Browse through the documentation of how the data was produced. 

   * Do you see any problems with the way the data was collected? produced? 
   * Is there anything that can cause bias or mislead?
   * What would you have done differently?

## Summary and conclusions

You have completed your first lab!

In this lab we had the opportunity to create our first plot (yay!). We analyzed it a bit, changed it to a different country, and also had a look at the underlying data.

In this lab I gave you most of the code readily made, but by the end of week 4 of the workshop, you will have all the knowledge to generate such plots on your own.

We had the opportunity to see different data types (character, date, and numeric).

We learned about tidy data, and also saw how data is transformed from a wide format to a long format.

I hope you enjoyed this lab. You can do it again from scratch by clicking "start over" in the left navigation bar. 